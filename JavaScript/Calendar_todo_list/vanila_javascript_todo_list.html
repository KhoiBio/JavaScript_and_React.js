<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Calendar To-Do with Completed</title>
  <style>
    body { font-family: Arial, sans-serif; max-width: 800px; margin: 30px auto; }
    .nav { margin-bottom: 10px; display: flex; justify-content: center; align-items: center; }
    .nav button { margin: 0 10px; padding: 5px 10px; }
    .month-title { font-weight: bold; font-size: 18px; }
    .calendar { display: grid; grid-template-columns: repeat(7, 1fr); gap: 8px; }
    .day { border: 1px solid #ccc; padding: 10px; min-height: 70px; cursor: pointer; text-align: center; }
    .day:hover { background-color: #f5f5f5; }
    .selected { background-color: #dbeafe; }
    .has-todo { font-weight: bold; }
    .todo { margin-top: 20px; }
    .todo input { width: 70%; padding: 6px; margin-right: 6px; }
    .todo button { padding: 6px 10px; }
    .todo li { margin: 6px 0; display: flex; align-items: center; }
    .todo li span.completed { text-decoration: line-through; color: #888; margin-left: 6px; flex-grow: 1; }
    .todo li button { margin-left: 10px; padding: 2px 6px; }
  </style>
</head>
<body>

<div class="nav">
  <button onclick="changeMonth(-1)">&#8592; Prev</button>
  <span id="monthTitle" class="month-title"></span>
  <button onclick="changeMonth(1)">Next &#8594;</button>
</div>

<div class="calendar" id="calendar"></div>

<div class="todo">
  <h3 id="selectedDate">Select a day</h3>
  <input id="todoInput" placeholder="New to-do..." />
  <button onclick="addTodo()">Add</button>
  <ul id="todoList"></ul>
</div>

<script>
const calendar = document.getElementById("calendar");
const monthTitle = document.getElementById("monthTitle");
const selectedDateEl = document.getElementById("selectedDate");
const todoInput = document.getElementById("todoInput");
const todoList = document.getElementById("todoList");

let todos = JSON.parse(localStorage.getItem("calendarTodos")) || {};

let today = new Date();
let currentMonth = today.getMonth();
let currentYear = today.getFullYear();
let selectedDate = null;

function saveTodos() {
  localStorage.setItem("calendarTodos", JSON.stringify(todos));
}

function renderCalendar() {
  calendar.innerHTML = "";
  const firstDay = new Date(currentYear, currentMonth, 1).getDay();
  const daysInMonth = new Date(currentYear, currentMonth + 1, 0).getDate();

  monthTitle.textContent = new Date(currentYear, currentMonth).toLocaleString("default", { month: "long", year: "numeric" });

  for (let i = 0; i < firstDay; i++) {
    calendar.appendChild(document.createElement("div"));
  }

  for (let day = 1; day <= daysInMonth; day++) {
    const div = document.createElement("div");
    div.className = "day";
    div.textContent = day;

    const dateKey = `${currentYear}-${currentMonth + 1}-${day}`;
    if (todos[dateKey]?.some(t => !t.completed)) {
      div.classList.add("has-todo");
    }

    div.onclick = () => selectDay(dateKey, div);
    calendar.appendChild(div);
  }
}

function selectDay(dateKey, element) {
  document.querySelectorAll(".day").forEach(d => d.classList.remove("selected"));
  element.classList.add("selected");

  selectedDate = dateKey;
  selectedDateEl.textContent = `To-Do for ${dateKey}`;
  renderTodos();
}

function renderTodos() {
  todoList.innerHTML = "";
  const list = todos[selectedDate] || [];
  list.forEach((todo, index) => {
    const li = document.createElement("li");

    const checkbox = document.createElement("input");
    checkbox.type = "checkbox";
    checkbox.checked = todo.completed;
    checkbox.onchange = () => toggleCompleted(index);

    const span = document.createElement("span");
    span.textContent = todo.text;
    if (todo.completed) span.classList.add("completed");

    const delBtn = document.createElement("button");
    delBtn.textContent = "Delete";
    delBtn.onclick = () => deleteTodo(index);

    li.appendChild(checkbox);
    li.appendChild(span);
    li.appendChild(delBtn);
    todoList.appendChild(li);
  });
}

function addTodo() {
  if (!selectedDate) return;
  const text = todoInput.value.trim();
  if (!text) return;

  todos[selectedDate] = todos[selectedDate] || [];
  todos[selectedDate].push({ text, completed: false });
  todoInput.value = "";
  saveTodos();
  renderTodos();
  renderCalendar();
}

function deleteTodo(index) {
  todos[selectedDate].splice(index, 1);
  saveTodos();
  renderTodos();
  renderCalendar();
}

function toggleCompleted(index) {
  todos[selectedDate][index].completed = !todos[selectedDate][index].completed;
  saveTodos();
  renderTodos();
  renderCalendar();
}

function changeMonth(offset) {
  currentMonth += offset;
  if (currentMonth > 11) { currentMonth = 0; currentYear++; }
  if (currentMonth < 0) { currentMonth = 11; currentYear--; }
  renderCalendar();
  selectedDate = null;
  selectedDateEl.textContent = "Select a day";
  todoList.innerHTML = "";
}

// Initial render
renderCalendar();
</script>

</body>
</html>
